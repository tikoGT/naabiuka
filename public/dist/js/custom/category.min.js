"use strict";function resfreshJSTree(){setTimeout(function(){$("#evts").jstree(!0).refresh()},500)}if($(".main-body .page-wrapper").find("#category-info-container").length){function a(){$("#status").val("Active").trigger("change"),$("#is_searchable").val(1).trigger("change"),$("#edit_id").val(null),$(".custom-file-label").text("Upload image"),$(".img-remove-icon").trigger("click"),$("#imageBlock").hide(),$("#note_txt_2").hide(),document.getElementById("categoryFrom").reset()}function b(a,b,c="edit"){$("#imageBlock").show(),$(".cursor_pointer > img").remove(),$(".sub-category").is(":disabled")&&1==b?$(".sub-category").prop("disabled",!1):!$(".sub-category").is(":disabled")&&0==b&&$(".sub-category").prop("disabled",!0),editId=a,$.ajax({url:SITE_URL+"/categories/edit",type:"POST",data:{_token:token,id:a,create_child:b},dataType:"json",success:function(a){$("input").each(function(){this.setCustomValidity("")}),$("#name").val(a.name).siblings(".error").remove(),$("#slug").val(a.slug).siblings(".error").remove(),$("#status").val(a.status).trigger("change"),$("#is_searchable").val(a.is_searchable).trigger("change"),$("#is_featured").val(a.is_featured).trigger("change"),$("#sell_commissions").val(getDecimalNumberFormat(a.sell_commissions)),$("#edit_id").val(editId),$(".cursor_pointer").empty(),$(".cursor_pointer").append("<img class=\"profile-user-img img-responsive fixSize neg-transition-scale\" src=\""+a.image_path+"\" alt=\"\" class=\"img-thumbnail attachment-styles\"/>"),null==a.parent_id?($("select[name=\"parent_id\"]").empty(),$("#parentBlock").hide()):($("#parentBlock").show(),$("select[name=\"parent_id\"]").empty(),$("select[name=\"parent_id\"]").append("<option value=\""+a.parent_id+"\">"+a.parent_name+"</option>")),e()}})}function c(b,c,d,e,f){clickOnSave("/categories/move-node","POST",{id:b,parent:c,old_parent:d,position:e,old_position:f}),a(),resfreshJSTree()}function d(){$.ajax({url:SITE_URL+"/categories/suggestion",type:"GET",data:{parnet_id:"none"==$("#parentBlock").css("display")?null:$("#parent_id").val(),name:$("#name").val()},dataType:"json",success:function(a){if("undefined"!=typeof a.id){$("#has_category").removeClass("display_none");let b=`${a.name} ${jsLang("found!")} ${jsLang("Please")}<a href="javascript:void(0)" data-category_id = ${a.id} class="assigned_category" id="assigned_category">&nbsp;${jsLang("click here")}&nbsp;</a> ${jsLang("to assign")}`;$("#has_category").html(b),$("#assigned_category").on("click",function(){f()})}else e()}})}function e(){$("#has_category").empty(),$("#has_category").addClass("display_none")}function f(){let b=$("#assigned_category").data("category_id");swal({title:jsLang("Are you sure?"),icon:"warning",buttons:!0,dangerMode:!0}).then(c=>{c&&$.ajax({type:"POST",url:SITE_URL+"/categories/assign-vendor",data:{_token:token,category_id:b},success:function(b){1==b.status?(swal(jsLang("Assigned Successfully"),{icon:"success",buttons:[!1,jsLang("Ok")]}),$("#has_category").addClass("display_none"),$("#has_category").empty(),a(),resfreshJSTree()):swal(jsLang("Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})})}var selectedNodeId="",selectedNodeName="",editId="";$(".sub-category").prop("disabled",!0),$("#parentBlock").hide(),$(".delete").hide(),$("#imageBlock").hide(),$(document).on("keyup","#name",function(){var a=this.value.replace(/[&\/\\#@,+()$~%.'":*?<>{}]/g,"");$("#slug").val(a.trim().toLowerCase().replace(/\s/g,"-")),4<=$("#name").val().length&&1==isAllowSuggestion&&d()}),$(document).on("keyup","#slug",function(){var a=this.value.replace(/[&\/\\#@,+()$~%.'":*?<>{}]/g,"");$("#slug").val(a.trim().toLowerCase().replace(/\s/g,"-"))}),$("#categoryFrom").on("submit",function(b){b.preventDefault();let c="",d=new FormData(this);"store"==$("#type").val()?c="/categories/store":"edit"==$("#type").val()&&(c="/categories/update"),clickOnSaveForm(c,"POST",d),a(),resfreshJSTree()}),$("#validatedCustomFile").on("change",function(){for(var a=[],b=0;b<$(this)[0].files.length;b++)a.push($(this)[0].files[b].name);$(this).next(".custom-file-label").html(a.join(", "));var c=this.files[0],d=c.type;return 0>$.inArray(d,["image/jpg","image/jpeg","image/png"])?($("#divNote").show(),$("#note_txt_1").hide(),$("#note_txt_2").html("<h6> <span class=\"text-danger font-weight-bolder\">"+jsLang("Invalid file extension")+"</span> </h6> <span class=\"badge badge-danger\">"+jsLang("Note")+"!</span> "+jsLang("Allowed File Extensions: jpg, png, gif, bmp")),$("#note_txt_2").show(),$("#prvw").hide(),!1):($("#prvw").show(),$("#note_txt_2, #note_txt_1").hide(),!0)}),$(".sub-category").on("click",function(){a(),$("#parentBlock").show(),$("select[name=\"parent_id\"]").empty(),$("select[name=\"parent_id\"]").append("<option value=\""+selectedNodeId+"\">"+selectedNodeName+"</option>"),$("#type").val("store"),$(".delete").hide()}),$(".root-category").on("click",function(){var b=$("#evts").jstree(!0);b.deselect_all(),$("#parentBlock").hide(),a(),$("#type").val("store"),$(".delete").hide()}),$(".delete").on("click",function(){confirmDeleteAjax("/categories/delete","POST",selectedNodeId,"resfreshJSTree"),$(".sub-category").prop("disabled",!0),a()}),$("#evts_button").on("click",function(){var a=$("#evts").jstree(!0);a.deselect_all(),a.select_node("1")}),$("#evts").on("changed.jstree",function(a,c){c.selected.length&&($("#type").val("edit"),$(".delete").show(),selectedNodeId=c.instance.get_node(c.selected[0]).id,selectedNodeName=c.instance.get_node(c.selected[0]).text,b(selectedNodeId,c.instance.get_node(c.selected[0]).original.create_child))}).on("move_node.jstree",function(a,b){4>b.node.parents.length?c(b.node.id,b.parent,b.old_parent,b.position,b.old_position):(swal(jsLang("Not Permitted"),{icon:"error",buttons:[!1,jsLang("Ok")]}),resfreshJSTree())}).jstree({core:{check_callback:!0,data:{url:SITE_URL+"/categories/get-data",dataType:"json"}},plugins:["dnd"]})}
