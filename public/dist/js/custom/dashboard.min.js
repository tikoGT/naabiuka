"use strict";$.fn.isInViewport=function(){return 0!=this.length&&this[0].getBoundingClientRect().top<$(window).height()};class AjaxRequest{static async call(t,e={}){return await fetch(t,Object.assign({method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}},e)).then(t=>t.json()).then(t=>t.response)}}class Dashboard{element;fetched=!1;links=[];params={};static getObject(){return null==this.myself&&(this.myself=new this),this.myself}async update(t){this.fetched=!0;let e=await AjaxRequest.call(t,this.params);if(this.getStatus(e))this.renderData(this.element,e);else throw Error(this.getErrMessage(e))}dataAlreadyFetched(t){return void 0!=dashboardAjaxData[t]}getFromFetchedData(t){return dashboardAjaxData[t]}sliceData(t,e=5){return t.slice(0,e)}switchView(){this.element.find(".placeholder-data").addClass("d-none"),this.element.find(".original-data").removeClass("d-none")}sync(t){this.hasObject()&&!this.fetched&&this.element.isInViewport()&&t&&this.update(t)}hasObject(){return void 0!=this.element&&!(this.element.length<1)}renderData(){throw Error("Must implement renderData() method.")}getStatus(t){return!!t.status&&!!t.status.code&&200==t.status.code}getErrMessage(t){return t.status.message}formatString(t,e=20,a="..."){return t.length>e-a.length?t.substr(0,e)+a:t}formatUrl(t,e,a=null){return a?t.replace(a,e):t.replace("__id__",e)}addLink(t,e){return this.links[e]=t,this}getLink(t,e,a=null){return void 0==this.links[t]?"#":a?this.links[t].replace(a,e):this.links[t].replace("__id__",e)}setParams(t){return this.params=t,this}resetFetch(){return this.fetched=!1,this}}class DashReport extends Dashboard{static myself=null;constructor(){super(),super.element=$("#dashboard-reports")}renderData(t,e){e=super.sliceData(e.records);let a="";e.forEach(t=>{a+="<tr class='unread'><td><img></td>",a+="<td><h6>"+t.title.substr(0,20)+"</H6></td>",a+='<td class=""><h6>11 MAY 12:56</h6></td>',a+='<td class=""><a href="#!" class="label bg-c-blue text-white f-12">View</a></td>',a+="</tr>"}),t.find(".original-data").append(a),super.switchView()}}class VendorStats extends Dashboard{static myself=null;constructor(){super(),super.element=$("#vendor-stat")}renderData(t,e){e=super.sliceData(e.records);let a="";e.forEach(t=>{if(t.name){a+='<tr class="unread"><td><h6 class="mb-0" data-url="'+t.url+'">'+t.name.substr(0,20)+"</H6></td>",a+='<td class="text-center">';for(let e=1;e<=5;e++)t.ratings>0?a+='<span><i class="fa fa-star f-12 text-c-yellow"></i></span>':a+='<span"><i class="fa fa-star f-12 star-inactive"></i></a>',t.ratings--;a+="</td>",a+='<td><h6 class="text-center mb-0">'+t.orders+"</h6></td>",a+='<td><h6 class="text-center mb-0">'+t.sales+"</h6></td>",a+='<td class="text-center"><a href="'+super.getLink("edit",t.id)+'" class="label view-color-btn f-12 text-2c">'+jsLang("VIEW")+"</a></td>",a+="</tr>"}}),0==e.length&&(t.find(".original-data").siblings("thead").remove(),a=`<tr class="border-0"><td colspan="2" class="border-0">${jsLang("No data found.")}</td></tr>`),t.find(".original-data").append(a),super.switchView()}}class MostVisitedReport extends Dashboard{static myself=null;constructor(){super(),super.element=$("#most-visited-page")}renderData(t,e){e=super.sliceData(e.records);let a="";e.forEach(t=>{a+='<tr class="unread">',a+="<td><h6 class='mb-0'>"+t.title.substr(0,20)+"</h6></td>",a+='<td class="text-right"><h6 class="mb-0">'+Math.floor(100*Math.random()+50)+"</h6></td>",a+="</tr>"}),t.find(".original-data").append(a),super.switchView()}}class CustomerComplain extends Dashboard{static myself=null;constructor(){super(),super.element=$("#customer-complain")}renderData(t,e){super.switchView()}}class MostActiveUsers extends Dashboard{static myself=null;constructor(){super(),super.element=$("#most-active-users")}isVendor=document.getElementById("vendor_dashboard_container");admin(t){let e="";return t.forEach(t=>{e+=`
                <tr class='unread'>
                    <td><a class="mb-0" target="_blank" href="${t.profile}">${super.formatString(t.name)}</a></td>
                    <td class="text-right">${t.total}</td>
                </tr>
            `}),e}vendor(t){let e="";return t.forEach(t=>{e+=`
                <tr class='unread'>
                    <td><span class=" mb-0">${super.formatString(t.name)}</span></td>
                    <td class="text-right">${t.total}</td>
                </tr>
            `}),e}renderData(t,e){e=super.sliceData(e.records);let a="";a=this.isVendor?this.vendor(e):this.admin(e),0==e.length&&(t.find(".original-data").siblings("thead").remove(),a=`<tr class="border-0"><td colspan="2" class="border-0">${jsLang("No data found.")}</td></tr>`),t.find(".original-data").append(a),super.switchView()}}class MostSoldProducts extends Dashboard{static myself=null;constructor(){super(),super.element=$("#most-sold-products")}renderData(t,e){e=super.sliceData(e.records);let a="";e.forEach(t=>{a+="<tr class='unread'>",a+=`<td><a class='mb-0' href='${t.url}' target="${"javascript:void(0)"==t.url?"_self":"_blank"}">${super.formatString(t.name)}</a></td>`,a+='<td class="text-right">'+t.total+" </td>",a+="</tr>"}),0==e.length&&(t.find(".original-data").siblings("thead").remove(),a=`<tr class="border-0"><td colspan="2" class="border-0">${jsLang("No data found.")}</td></tr>`),t.find(".original-data").append(a),super.switchView()}}var ctx=$("#chart-area-2");ctx.height(335);class SaleOfThisMonth extends Dashboard{static myself=null;chartInstance=null;constructor(){super(),super.element=$("#sale-of-this-month")}renderData(t,e){this.lineChart(t,e),super.switchView()}lineChart=(t,e)=>{t.find(".placeholder").addClass("d-none");let a=t.find("#chart-area-2");a.removeClass("d-none"),this.updateChart(a[0],e.records)};dayMonth(t){let e=new Date;e.setMonth(t-1);let a=e.getFullYear().toLocaleString(localeString);return t<=0&&(t+=12),e.toLocaleString(localeString,{month:"short"})+" "+a}monthToColor(t){var e;return t%3==0?"rgba(252, 202, 25, 1)":t%3==1?"rgba(227, 147, 255, 1)":"rgba(0, 223, 255, 1)"}updateChart=(t,e)=>{var a=t.getContext("2d"),s=[];for(let r in e.values){var n=a.createLinearGradient(0,0,500,0);n.addColorStop(1,this.monthToColor(r));let d={label:this.dayMonth(r),data:e.values[r],borderWidth:4,borderColor:n,backgroundColor:n,hoverborderColor:n,hoverBackgroundColor:n,tension:.1};s.push(d)}var i={labels:e.dates,datasets:s};this.chartInstance=new Chart(a,{type:"line",data:i,responsive:!0,fill:!0,options:{scales:{y:{title:{display:!0,text:jsLang("Sales")}}}}})}}class VendorReq extends Dashboard{static myself=null;constructor(){super(),super.element=$("#vendor-request")}renderData(t,e){e=super.sliceData(e.records);let a="";e.forEach(t=>{a+='<tr class="unread">',a+='<td> <img class="rounded-circle w-30p" src="'+t.file_url+'" alt="activity-user"> </td>',a+='<td><h6 class="mb-0" data-url="'+t.url+'">'+t.name.substr(0,20)+"</h6></td>",a+='<td class="text-center"> <h6 class="text-muted mb-0">'+t.created_at+"</h6></td>",a+='<td class="text-right"> <a target="_blank" href="'+t.view+'" class="label view-color-btn text-2c f-12">'+jsLang("View")+'</a><a class="label f-12 text-white accept-color-btn" target="_blank" href="'+t.view+'">'+jsLang("Accept")+'</a><a class="label text-white f-12 reject-color-btn" target="_blank" href="'+t.view+'">'+jsLang("Reject")+"</a></td>",a+="</tr>"}),0==e.length&&(t.find(".original-data").siblings("thead").remove(),a=`<tr class="border-0"><td colspan="2" class="border-0">${jsLang("No data found.")}</td></tr>`),t.find(".original-data").append(a),super.switchView()}}function donutChart(){var t=document.getElementById("chart-donut-1").getContext("2d"),e={labels:chartOrderStatus.status||[],datasets:[{data:chartOrderStatus.count||0,backgroundColor:["#fcca19","#FFA826","#E393FF","#00DFFF","#33C172"],hoverBackgroundColor:["#fcca19","#FFA826","#E393FF","#00DFFF","#33C172"]}]};new Chart(t,{type:"doughnut",data:e,responsive:!0,options:{maintainAspectRatio:!1}})}$(document).ready(function(){let t=()=>{DashReport.getObject().sync(),MostVisitedReport.getObject().sync(),CustomerComplain.getObject().sync(),VendorStats.getObject().addLink(vendorEdiUrl,"edit").sync(vendorStatsUrl),MostActiveUsers.getObject().sync(mostActiveUsersUrl),MostSoldProducts.getObject().sync(mostSoldProductsUrl),SaleOfThisMonth.getObject().sync(salesOfThisMonth),"undefined"!=typeof vendorReqsUrl&&VendorReq.getObject().addLink(vendorReqsUrl,"edit").sync(vendorReqsUrl)};function e(){$(".placeholder-data-sta").removeClass("d-none"),$(".original-data-sta").addClass("d-none"),$(".original-data-sta").empty()}$(document).on("scroll",()=>{t()}),$(document).on("click",".daily",function(t){t.preventDefault(),e(),VendorStats.getObject().resetFetch().sync(vendorStatsUrlDaily)}),$(document).on("click",".weekly",function(t){t.preventDefault(),e(),VendorStats.getObject().resetFetch().sync(vendorStatsUrlWeekly)}),$(document).on("click",".monthly",function(t){t.preventDefault(),e(),VendorStats.getObject().resetFetch().sync(vendorStatsUrlMonthly)}),$(document).on("click",".yearly",function(t){t.preventDefault(),e(),VendorStats.getObject().resetFetch().sync(vendorStatsUrlYearly)}),$(document).on("click",".vendor-req",function(t){t.preventDefault();let e=$(this).attr("data-url");$(".placeholder-data-req").removeClass("d-none"),$(".original-data-req").addClass("d-none"),$(".original-data-req").empty(),VendorReq.getObject().resetFetch().sync(e)}),t()}),$(".main-body .chart-order-status").find("#chart-donut-1").length&&$(document).ready(function(){donutChart()}),$(function(){var t={};$(".grid-stack-item").each((e,a)=>{t[$(a).attr("data-gs-id")]={x:$(a).attr("data-gs-x"),y:$(a).attr("data-gs-y"),width:$(a).attr("data-gs-width"),height:$(a).attr("data-gs-height"),html:$(a).html()}});var e={};$(".dashboard-option-checkbox").each((t,a)=>{e[$(a).attr("id")]=$(a).is(":checked")}),e={...e,...dashboardCacheWidgetOption};var a={...t,...dashboardCacheWidgetElement};$(".grid-stack-item").each((t,e)=>{var s=$(e).attr("data-gs-id");$(e).attr("data-gs-x",a[s].x),$(e).attr("data-gs-y",a[s].y),$(e).attr("data-gs-width",a[s].width),$(e).attr("data-gs-height",a[s].height)});var s=$(".grid-stack").gridstack(widgetOptions).data("gridstack");function r(e){t[e].html=$(`.grid-stack-item[data-gs-id=${e}]`).html(),s.removeWidget($(`.grid-stack-item[data-gs-id=${e}]`))}function n(t,e){$.ajax({url:SITE_URL+t,type:"POST",data:{_token:token,data:e},success:function(t){}})}var d={};$(".grid-stack").on("change",function(t,e){$(e).each((t,e)=>{d[e.id]={x:e.x,y:e.y,width:e.width,height:e.height}}),n("/dashboard/widget",JSON.stringify({...dashboardCacheWidgetElement,...d}))}),$(".dashboard-option-checkbox").on("change",function(){var a=$(this).attr("id");$(this).is(":checked")?s.addWidget(`<div class='grid-stack-item' data-gs-id='${a}'>${t[a].html}</div>`,t[a].x,t[a].y,t[a].width,t[a].height):r(a),$(".grid-stack").gridstack(widgetOptions).data("gridstack"),e[$(this).attr("id")]=$(this).is(":checked"),n("/dashboard/widget/option",JSON.stringify(e))}),$(".dashboard-option-checkbox").each((t,a)=>{var s=$(a).attr("id");$(a).prop("checked",e[s]),$(a).is(":checked")||r(s)})});
