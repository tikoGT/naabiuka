"use strict";function changeSetting(parent){$(parent).closest(".parent").find(".warning-message").addClass("alert-secondary"),$(parent).closest(".parent").find(".warningMessage").slideDown(300),$(parent).closest(".parent").find("#warning-msg").html(jsLang("Settings have changed, you should save them!"))}function successNotification(parent,message){parent.find(".abc").addClass("alert-success"),parent.find(".warningMessage").slideDown(),parent.find(".msg").html(message)}function failNotification(parent,message){parent.find(".abc").addClass("alert-danger"),parent.find(".warningMessage").slideDown(),parent.find(".msg").html(message)}function errorNotification(parent,data){parent.find(".abc").addClass("alert-danger"),parent.find(".warningMessage").slideDown(),$.each(data.responseJSON.errors,(function(key,value){parent.find(".msg").html(value)}))}function timeoutNotification(parent){setTimeout(()=>{parent.closest(".parent").find(".warningMessage").slideUp(500),setTimeout(()=>{parent.closest(".parent").find(".abc").removeClass("alert-success alert-danger")},501)},5e3)}$(".conditional").ifs(),$("#v-pills-general-tab").trigger("click"),$(document).on("change","input, select",(function(){changeSetting(this)})),$(document).on("click",".tab-name",(function(){var id=$(this).attr("data-id");$("#theme-title").html(id),$('.tab-pane[aria-labelledby="home-tab"').addClass("show active"),$("#"+$(this).attr("id")).addClass("active").attr("aria-selected",!0)})),$(document).on("click",".cr",(function(){var value;1==$(this).closest(".switch").find("input").val()?$(this).closest(".switch").find("input").val(0):$(this).closest(".switch").find("input").val(1)}));const unblockEverything=()=>{$(".blockUI").each((function(){$(this).parent().unblock()}))},blockElement=(element,_data={})=>{let options=Object.assign({},{message:'<div class="spinner-border tax-rate-loader text-warning" role="status"><span class="sr-only">Loading...</span></div>',css:{backgroundColor:"transparent",border:"none"}},_data);element.block(options)},triggerNotification=msg=>{$(".notification-msg-bar").find(".notification-msg").html(msg),$(".notification-msg-bar").removeClass("smoothly-hide"),setTimeout(()=>{$(".notification-msg-bar").addClass("smoothly-hide"),$(".notification-msg-bar").find(".notification-msg").html("")},3e3)};$(document).on("click",".add-btn",(function(){var classId=$(this).attr("data-id");$('input[name="tax_class_id"]').val(classId);var randCompound=Math.floor(1e5*Math.random()),randShipping=Math.floor(1e5*Math.random());$(".add-new-data").find('input[name="compound"]').attr("id","switch-"+randCompound).closest(".switch").find("label").attr("for","switch-"+randCompound),$(".add-new-data").find('input[name="shipping"]').attr("id","switch-"+randShipping).closest(".switch").find("label").attr("for","switch-"+randShipping);var data=$(".add-new-data").html(),tr=$(this).closest("tr");$(tr).closest("tbody").find('td:contains("No tax rate found")').remove(),tr.html(data),tr.closest("table tbody").append(`\n        <tr>\n            <td colspan="10" class="pt-3">\n                <button type="button" data-id="${classId}" class="btn custom-btn-submit btn-sm add-btn">${jsLang("Add New")}</button>\n                <button type="submit" data-id="${classId}" class="btn custom-btn-submit btn-sm update-btn">${jsLang("Save")}</button>\n            </td>\n        </tr>\n    `)})),$(document).on("click",".update-btn",(function(){var parent=$(this).closest(".parent");if(1==is_demo)return triggerNotification(jsLang("Demo Mode! This action can't be perform.")),!1;blockElement(parent);var url=SITE_URL+"/tax-rate/update",btn=this;$(this).text(jsLang("Saving")).append('<div class="spinner-border spinner-border-sm ml-2" role="status"></div>');var arr=new Array;$(this).closest(".tax-rate-data").find("tr").each((key,value)=>{if($(value).find("input, select").length>10){var obj=new Object,sort_by=0;$(value).find("input, select").each((k,v)=>{obj[$(v).attr("name")]="*"==$(v).val().trim()?"":$(v).val(),""!=$(v).val().trim()&&"*"!=$(v).val().trim()&&("country"==$(v).attr("name")?sort_by+=8:"state"==$(v).attr("name")?sort_by+=4:"city"==$(v).attr("name")?sort_by+=2:"postcode"==$(v).attr("name")&&(sort_by+=1)),obj.sort_by=sort_by}),obj.country=obj.country.toLowerCase(),arr.push(obj)}}),0==arr.length&&arr.push({tax_class_id:$(btn).attr("data-id")}),$.ajax({url:url,type:"POST",data:{_token:token,data:arr},success:function(data){$("#topNav-v-pills-tabContent").html(data),$('a[href="#v-pills-general"]').tab("show"),$(`a[href="#${$(parent).attr("id")}"]`).tab("show"),triggerNotification(jsLang("Tax rate has been successfully saved"))},error:function(data){triggerNotification(jsLang("Something went wrong, please try again."))},complete:function(data){unblockEverything()}})})),$(document).on("click",".action-btn",(function(){changeSetting(this),$(this).closest("tr").remove()}));var taxClassStoreCount=0;$(document).on("submit","#addTaxClass",(function(e){if(e.preventDefault(),++taxClassStoreCount>1)return!1;var form=this,parent=$(".tax-setting-parent");$.ajax({url:$(form).attr("action"),type:"POST",data:$(form).serialize(),dataType:"JSON",success:function(data){if("success"==data.status){var tax_class_name=data.name,tax_class_slug=data.slug,classId=data.id;successNotification(parent,data.message);var classButton=`\n                <div class="toast rounded-0 shadow-none text-dark border bg-light mb-2 tax-class w-100">\n                    <div class="d-flex justify-content-between align-items-center p-2">\n                        <div class="toast-body pe-3 font-bold ps-0 py-0 mr-4 font-weight-bold tax-class-name">\n                            ${tax_class_name+" "+jsLang("Rates")}\n                        </div>\n                        <div>\n                            <a href="javascript:void(0)"\n                                data-bs-toggle="modal"\n                                data-bs-target="#edit-tax-class"\n                                data-id="${classId}"\n                                data-name="${tax_class_name}"\n                                data-slug="${tax_class_slug}"\n                                class="text-dark edit-tax-class-btn">\n                                <span title="${jsLang("Edit")}" class="fa fa-edit neg-transition-scale"> &nbsp;</span>\n                            </a>\n                            <form method="post" action="tax/delete/${classId}" id="delete-tax-${classId}" accept-charset="UTF-8" class="display_inline delete_tax_class">\n                                <input type="hidden" name="_token" value="${token}">\n                                <span class="text-dark cursor_pointer delete-button" data-bs-toggle="modal" data-label="Delete" data-delete="tax" data-bs-target="#confirmDelete"\n                                    data-id="${classId}" title="${jsLang("Delete Tax")}" data-title="${jsLang("Delete Tax")}" data-message="${jsLang("Are you sure to delete this?")}">\n                                    <i class="fa fa-trash"></i>\n                                </span>\n                            </form>\n                        </div>\n\n                    </div>\n                </div>\n                `;$("div.add-new-class").before(classButton),$(".nav-pills").append(`\n                    <li><a class="nav-link text-left tab-name" id="v-pills-${tax_class_slug}-tab" data-bs-toggle="pill" href="#v-pills-${tax_class_slug}" role="tab" aria-controls="v-pills-standard" aria-selected="true" data-id ="${tax_class_name+" "+jsLang("Rates")}">${tax_class_name+" "+jsLang("Rates")}</a></li>\n                `),$(".tax-content").append(`\n                <div class="tab-pane fade parent mt-25 tax-rate-data" id="v-pills-${tax_class_slug}" role="tabpanel" aria-labelledby="v-pills-${tax_class_slug}-tab">\n                    <div class="noti-alert pad no-print warningMessage mt-2 px-2">\n                        <div class="alert warning-message abc">\n                            <strong id="warning-msg" class="msg"></strong>\n                        </div>\n                    </div>\n                    <div class="row px-4">\n                        <div class="col-sm-12 p-0">\n                            <div class="table-responsive">\n                                <table class="table table-bordered table-hover">\n                                    <thead>\n                                        <tr>\n                                            <th scope="col">${jsLang("Name")}</th>\n                                            <th scope="col">${jsLang("Country")}</th>\n                                            <th scope="col">${jsLang("State")}</th>\n                                            <th scope="col">${jsLang("City")}</th>\n                                            <th scope="col">${jsLang("Post code")}</th>\n                                            <th width="100" scope="col">${jsLang("Rate")} %</th>\n                                            <th width="100" scope="col">${jsLang("Priority")}</th>\n                                            <th width="5" scope="col">${jsLang("Compound")}</th>\n                                            <th width="5" scope="col">${jsLang("Shipping")}</th>\n                                            <th width="5" scope="col">${jsLang("Action")}</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody>\n                                        <tr>\n                                            <td class="text-center" colspan="10">${jsLang("No tax rate found.")}</td>\n                                        </tr>\n                                        <tr>\n                                            <td colspan="10" class="pt-3">\n                                                <button type="button" data-id="${classId}" class="btn custom-btn-submit btn-sm add-btn">${jsLang("Add New")}</button>\n                                            </td>\n                                        </tr>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                `),$("#shipping_tax_class").append(`\n                    <option value="${tax_class_slug}">${tax_class_name}</option>\n                `),$(form).trigger("reset")}else failNotification(parent,data.message);$(form).closest(".tax-class").remove()},error:function(data){errorNotification(parent,data)},complete:function(data){$(".modal").modal("hide"),$(".spinner-border").remove(),$(".tax-class-submit").text(jsLang("Save")),taxClassStoreCount=0}}),timeoutNotification(parent)})),$(document).on("click",".edit-tax-class-btn",(function(){$("#edit-tax-class").find('input[name="id"]').val($(this).attr("data-id")),$("#edit-tax-class").find('input[name="name"]').val($(this).attr("data-name")),$("#edit-tax-class").find('input[name="slug"]').val($(this).attr("data-slug"))}));var editTaxClassBtn="";$(document).on("click",".edit-tax-class-btn",(function(){editTaxClassBtn=this}));var taxClassUpdateCount=0;$(document).on("submit","#edit-tax-form",(function(e){if(e.preventDefault(),++taxClassUpdateCount>1)return!1;var form=this,parent=$(".tax-setting-parent");$.ajax({url:$(this).attr("action"),type:"POST",data:$(this).serialize(),dataType:"JSON",success:function(data){if("success"==data.status){var tax_class_name=data.name,tax_class_slug=data.slug;successNotification(parent,data.message);var taxName=tax_class_name+" "+jsLang("Rates");$(editTaxClassBtn).closest(".tax-class").find(".tax-class-name").text(taxName);var classTab=$(`#v-pills-${$(editTaxClassBtn).attr("data-slug")}-tab`);$(".nav-pills").append(`\n                    <li><a class="nav-link text-left tab-name" id="v-pills-${tax_class_slug}-tab" data-bs-toggle="pill" href="#v-pills-${tax_class_slug}" role="tab" aria-controls="v-pills-standard" aria-selected="true" data-id ="${tax_class_name+" "+jsLang("Rates")}">${tax_class_name+" "+jsLang("Rates")}</a></li>\n                `),$("#shipping_tax_class").find(`option[value="${$(editTaxClassBtn).attr("data-slug")}"]`).attr("value",tax_class_slug).text(tax_class_name),classTab.remove();var classRates=$(`#v-pills-${$(editTaxClassBtn).attr("data-slug")}`);classRates.attr("aria-labelledby",`v-pills-${tax_class_slug}-tab`),classRates.attr("id",`v-pills-${tax_class_slug}`),$(editTaxClassBtn).attr("data-name",tax_class_name).attr("data-slug",tax_class_slug)}else failNotification(parent,data.message)},error:function(data){errorNotification(parent,data)},complete:function(data){$(".modal").modal("hide"),$(".spinner-border").remove(),$(".tax-class-submit").text(jsLang("Save")),taxClassUpdateCount=0}}),timeoutNotification(parent)})),$(document).on("click","#confirmDeleteSubmitBtn",(function(){$(this).text(jsLang("Deleting")).append('<div class="spinner-border spinner-border-sm ml-2" role="status"></div>')}));var taxDeleteCount=0;$(document).on("submit",".delete_tax_class",(function(e){if(e.preventDefault(),!(++taxDeleteCount>1)){var parent=$(this).closest(".parent"),form=this;$.ajax({url:$(form).attr("action"),type:"POST",data:{_token:token},dataType:"JSON",success:function(data){if("success"==data.status){successNotification(parent,data.message),$(parent).closest("tr").remove();var slug=$(form).closest("div").find("a").attr("data-slug");$(`#v-pills-${slug}-tab`).remove(),$(`#v-pills-${slug}`).remove(),$("#shipping_tax_class").find(`option[value="${slug}"]`).remove()}else failNotification(parent,data.message);$(form).closest(".tax-class").remove()},error:function(data){errorNotification(parent,data)},complete:function(data){$(".modal").modal("hide"),taxDeleteCount=0}}),timeoutNotification(parent)}}));var taxUpdateCount=0;$(document).on("click",".tax-setting-btn",(function(){if(!(++taxUpdateCount>1)){var parentTr=$(this).closest("tr"),parent=$(this).closest(".parent");$(this).text(jsLang("Saving")).append('<div class="spinner-border spinner-border-sm ml-2" role="status"></div>').addClass("disabled-btn"),$.ajax({url:SITE_URL+"/tax-setting/update",type:"POST",data:$(".tax-setting").find("input, select").serialize(),dataType:"JSON",success:function(data){"success"==data.status?(successNotification(parent,data.message),parentTr.remove()):failNotification(parent,data.message)},error:function(data){errorNotification(parent,data)},complete:function(){$(".tax-class-submit").text(jsLang("Save")).removeClass("disabled-btn").find(".spinner-border").remove(),taxUpdateCount=0}}),timeoutNotification(parent)}}));var currentTab="v-pills-general-tab",activeHelp=!1;$(document).on("click",".tab-name",(function(){"v-pills-help-tab"!=$(this).attr("id")&&(currentTab=$(this).attr("id"),activeHelp=!1),$(".tab-help").removeClass("active"),$(".tab-pane").removeClass("show active"),$(`.tab-pane[aria-labelledby="${$(this).attr("id")}"`).addClass("show active"),$('.tab-pane[aria-labelledby="home-tab"').addClass("show active"),$(".tab-help").css("color","#6c757d"),"Options"==$(this).text()?$(".tab-help").hide():$(".tab-help").show()})),$(document).on("click",".tab-name.tab-help",(function(){if(activeHelp)return $("#"+currentTab).trigger("click"),!1;$(".tab-name").removeClass("active"),$(this).addClass("active"),$(this).css("color","#fcca19"),activeHelp=!0})),$(".main-body .page-wrapper").find("#tax-container").length&&$('.tab-pane[aria-labelledby="v-pills-general-tab"').addClass("show active");